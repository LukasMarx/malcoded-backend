import { Controller, Get, Headers } from '@nestjs/common';

@Controller('geoip')
export class GeoIpController {
  constructor() {}

  private isoCodes = {
    // EU 28:
    AT: 'Austria',
    BE: 'Belgium',
    BG: 'Bulgaria',
    HR: 'Croatia',
    CY: 'Cyprus',
    CZ: 'Czech Republic',
    DK: 'Denmark',
    EE: 'Estonia',
    FI: 'Finland',
    FR: 'France',
    DE: 'Germany',
    GR: 'Greece',
    HU: 'Hungary',
    IE: 'Ireland, Republic of (EIRE)',
    IT: 'Italy',
    LV: 'Latvia',
    LT: 'Lithuania',
    LU: 'Luxembourg',
    MT: 'Malta',
    NL: 'Netherlands',
    PL: 'Poland',
    PT: 'Portugal',
    RO: 'Romania',
    SK: 'Slovakia',
    SI: 'Slovenia',
    ES: 'Spain',
    SE: 'Sweden',
    GB: 'United Kingdom (Great Britain)',

    // Outermost Regions (OMR)
    // https://en.wikipedia.org/wiki/Special_member_state_territories_and_the_European_Union#Outermost_regions
    GF: 'French Guiana',
    GP: 'Guadeloupe',
    MQ: 'Martinique',
    ME: 'Montenegro',
    YT: 'Mayotte',
    RE: 'Réunion',
    MF: 'Saint Martin',
    // No Code, Azores
    // No Code, Canary Islands
    // No Code, Madeira

    // Special Cases: Part of EU
    // https://en.wikipedia.org/wiki/Special_member_state_territories_and_the_European_Union#Special_cases_in_Europe
    GI: 'Gibraltar',
    AX: 'Åland Islands',
    // No Code, Büsingen am Hochrhein
    // No Code, Campione d'Italia and Livigno
    // No Code, Ceuta and Melilla
    // No Code, UN Buffer Zone in Cyprus
    // No Code, Helgoland
    // No Code, Mount Athos

    // Overseas Countries and Territories (OCT)
    // https://en.wikipedia.org/wiki/Special_member_state_territories_and_the_European_Union#Overseas_countries_and_territories
    PM: 'Saint Pierre and Miquelon',
    GL: 'Greenland',
    BL: 'Saint Bartelemey',
    SX: 'Sint Maarten',
    AW: 'Aruba',
    CW: 'Curacao',
    WF: 'Wallis and Futuna',
    PF: 'French Polynesia',
    NC: 'New Caledonia',
    TF: 'French Southern Territories',
    AI: 'Anguilla',
    BM: 'Bermuda',
    IO: 'British Indian Ocean Territory',
    VG: 'Virgin Islands, British',
    KY: 'Cayman Islands',
    FK: 'Falkland Islands (Malvinas)',
    MS: 'Montserrat',
    PN: 'Pitcairn',
    SH: 'Saint Helena',
    GS: 'South Georgia and the South Sandwich Islands',
    TC: 'Turks and Caicos Islands',

    // Microstates
    // https://en.wikipedia.org/wiki/Microstates_and_the_European_Union
    AD: 'Andorra',
    LI: 'Liechtenstein',
    MC: 'Monaco',
    SM: 'San Marino',
    VA: 'Vatican City',

    // Other (Not sure how these fit in)
    JE: 'Jersey',
    GG: 'Guernsey',
  };

  @Get('/isEu')
  async isEU(@Headers('HTTP_CF_IPCOUNTRY') location) {
    if (!location) {
      return { clearResult: false, isEU: true };
    }
    if (this.isoCodes[location]) {
      return { clearResult: true, isEU: true };
    }
    return { clearResult: true, isEU: false };
  }
}
